---
title: "MB5370 Module 4 - Workshop3 - Data Wrangling in R"
author: "Tory Pritchard"
date: "2024-05-16"
output: html_document
---

#____________________________________________________________________________
Workspace/Rmd file location
C:/Users/Admin/OneDrive/Documents/MB5370/Module_04/Mod4_Personal/Workshop3.Rmd
File also in Git hub!

Description: This workshop follows the data tidying section of the [R4DS textbook](https://r4ds.hadley.nz/data-tidy#sec-tidy-data). Aim is to take a tabular dataset and prepare it in any way you need.
Data tidying - aka data wrangling - is crucial to actually order to actually use your valuable data.

Tibbles
Used in place of the traditional data frames when using the tidyr package. They are slightly adjusted data frames designed to keep up without breaking existing code. 'Future proof' data frames.

#____________________________________________________________________________

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Install and load tidyverse packages
```{r}
## install.packages("tidyverse") # Delete this line once installed
library("tidyverse")

#and other packages
library(DataViz)
library(ggplot2)
library(tidyr)
library(tidyverse)
library(palmerpenguins)
library(ggthemes)
#devtools::install_github("kjhealy/socviz")
```

# Tidy data
Rearranging data to a format more appropriate for analysis.
See tibble for the first time:
```{r}
table1
#> # A tibble: 6 × 4
#>   country      year  cases population
#>   <chr>       <int>  <int>      <int>
#> 1 Afghanistan  1999    745   19987071
#> 2 Afghanistan  2000   2666   20595360
#> 3 Brazil       1999  37737  172006362
#> 4 Brazil       2000  80488  174504898
#> 5 China        1999 212258 1272915272
#> 6 China        2000 213766 1280428583
table2
#> # A tibble: 12 × 4
#>   country      year type           count
#>   <chr>       <int> <chr>          <int>
#> 1 Afghanistan  1999 cases            745
#> 2 Afghanistan  1999 population  19987071
#> 3 Afghanistan  2000 cases           2666
#> 4 Afghanistan  2000 population  20595360
#> 5 Brazil       1999 cases          37737
#> 6 Brazil       1999 population 172006362
#> # ... with 6 more rows
table3
#> # A tibble: 6 × 3
#>   country      year rate             
#> * <chr>       <int> <chr>            
#> 1 Afghanistan  1999 745/19987071     
#> 2 Afghanistan  2000 2666/20595360    
#> 3 Brazil       1999 37737/172006362  
#> 4 Brazil       2000 80488/174504898  
#> 5 China        1999 212258/1272915272
#> 6 China        2000 213766/1280428583
```

How we make our dataset tidy is by following three interrelated rules. 
Each variable must have its own column.
Each observation must have its own row.
Each value must have its own cell.

Picture from textbook can help visualize these rules.

# Pipes intro
A pipe is really only designed to help you better understand what the code is doing.
ex. You take the data, use a pipe and apply a function to it, specifying arguments inside the function (like below, we apply the function mutate to compute the rate given two variables).
```{r}
# Compute rate per 10,000
table1 %>% 
  mutate(rate = cases / population * 10000)
#> # A tibble: 6 × 5
#>   country      year  cases population  rate
#>   <chr>       <int>  <int>      <int> <dbl>
#> 1 Afghanistan  1999    745   19987071 0.373
#> 2 Afghanistan  2000   2666   20595360 1.29 
#> 3 Brazil       1999  37737  172006362 2.19 
#> 4 Brazil       2000  80488  174504898 5.61 
#> 5 China        1999 212258 1272915272 1.67 
#> 6 China        2000 213766 1280428583 1.67

# Compute cases per year
table1 %>% 
  count(year, wt = cases)
#> # A tibble: 2 × 2
#>    year      n
#>   <int>  <int>
#> 1  1999 250740
#> 2  2000 296920

# Visualise changes over time
library(ggplot2)
ggplot(table1, aes(year, cases)) + 
  geom_line(aes(group = country), colour = "grey50") + 
  geom_point(aes(colour = country))
```

Understanding whether your data frame structure is optimal (or tidy) is a fundamental skill for a data scientist.

EXERCISE to do later!!!!
For each of the sample tables, describe what each observation and each column represents.
Sketch out the processes you would use to calculate the rate for table2 and table3. You will need to perform four operations:
Extract the number of TB cases per country per year
Extract the matching population per country per year
Divide cases by population, and multiply by 10,000
Store back in the appropriate place
Hint: you haven’t yet learned the functions you need to actually perform these, but you can still think through the transformations!

```{r}

```

# Pivoting data to it tidy
First step in tidying is to understand what each variable and observation means.
Second step is to resolve one of the two common problems with untidy. These are:
  One variable is spread across multiple columns
  One observation is scattered across multiple rows

```{r}

```


